# 神农集团数字化平台 v2.0 - 完整开发文档

> 🌾 现代化重构版本 - 智慧农牧业数字化转型解决方案

**文档版本：** v2.1.0  
**最后更新：** 2025年1月16日  
**维护团队：** 神农集团技术团队

---

## 📑 目录

1. [项目概述](#项目概述)
2. [快速开始](#快速开始)
3. [项目架构](#项目架构)
4. [核心功能](#核心功能)
5. [AI功能详解](#ai功能详解)
6. [开发指南](#开发指南)
7. [部署说明](#部署说明)
8. [更新日志](#更新日志)
9. [常见问题](#常见问题)
10. [技术支持](#技术支持)

---

## 项目概述

### 简介

神农集团数字化平台v2.0是一个面向农牧业生产管理的现代化Web应用系统，经过完整重构升级。平台采用模块化架构和事件驱动设计，集成了AI智能助手、思维导图工具、系统导航门户等核心模块，为农牧业企业提供智能化数字化转型解决方案。

### 核心特性

- 🤖 **AI智能助手** - 神农晓问，专业的农牧业智能咨询助手，支持流式对话
- 🧠 **思维导图工具** - 在线业务规划和流程梳理工具，支持实时协作
- 🏢 **系统门户** - 12个业务系统的统一入口和智能导航
- 📊 **数据可视化** - 商业地产平面图和业务数据实时展示
- 📱 **响应式设计** - 完美支持桌面端、平板和移动端访问
- 🔄 **实时交互** - 基于SSE的流式对话和实时数据更新
- ⚡ **现代化架构** - Vite构建工具，ES6+模块化，高性能体验

### 技术栈

- **构建工具**: Vite 5.x
- **开发语言**: 原生JavaScript ES6+
- **样式技术**: CSS3 + CSS Variables
- **图标库**: Font Awesome 6.4.0
- **HTTP客户端**: Axios 1.6.2
- **日期处理**: Day.js 1.11.10

---

## 快速开始

### 环境要求

- Node.js >= 16.0.0
- npm >= 8.0.0
- 现代浏览器 (Chrome 80+, Firefox 75+, Safari 13+, Edge 80+)

### 安装和运行

```bash
# 克隆项目
git clone https://github.com/your-org/shengnong-platform-v2.git
cd shengnong-platform-v2

# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 预览生产版本
npm run preview
```

### 访问地址

- 🏠 **开发服务器**: http://localhost:3000
- 🏢 **系统门户**: http://localhost:3000/#/
- 🤖 **AI助手**: http://localhost:3000/#/ai-assistant
- 🧠 **思维导图**: http://localhost:3000/#/mindmap
- 📊 **平面图**: http://localhost:3000/#/floorplan

---

## 项目架构

### 目录结构

```
shengnong-platform-v2/
├── public/                     # 静态资源
├── src/                        # 源代码
│   ├── components/             # 可复用组件
│   ├── pages/                 # 页面组件
│   ├── services/              # 服务层
│   ├── utils/                 # 工具函数
│   ├── styles/                # 样式文件
│   ├── assets/                # 静态资源
│   ├── main.js                # 应用入口
│   ├── app.js                 # 应用主类
│   └── router.js              # 路由管理
├── tests/                     # 测试文件
├── docs/                      # 文档
├── package.json               # 项目配置
└── vite.config.js            # Vite配置
```

### 架构设计

```
┌─────────────────────────────────────────┐
│         前端展示层 (Pages)               │
│  HomePage | AIAssistantPage | MindMapPage│
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│      业务逻辑层 (Services)               │
│  AIService | ConfigService | Router      │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│      工具函数层 (Utils)                  │
│  EventBus | Helpers | Constants          │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│      数据存储层 (Storage)                │
│  LocalStorage | SessionStorage | Memory  │
└─────────────────────────────────────────┘
```

---

## 核心功能

### 1. 系统门户 (HomePage)

**核心功能：**
- 🎯 12个业务系统快速导航和智能搜索
- 🔍 实时搜索和分类筛选，支持模糊匹配
- 📊 网格/列表视图切换，个性化展示
- ⭐ 系统收藏管理，快速访问常用系统
- 📈 实时在线用户统计和系统状态监控
- 🤖 集成AI助手浮动按钮，随时获得帮助

**业务系统清单：**
1. 🏭 生产管理平台
2. 🐄 智慧养殖系统
3. 🌾 饲料管理系统
4. 🏥 兽医服务平台
5. 🚚 智慧物流系统
6. 🛡️ 食品安全追溯
7. 💰 财务管理系统
8. 👥 人力资源平台
9. 🌱 环保监测系统
10. 📊 BI数据分析
11. 🛒 采购管理系统
12. 📱 移动办公OA

---

## AI功能详解

### AI智能助手概述

神农晓问是平台的核心AI功能，提供专业的农牧业智能咨询服务。

### 功能特性

- 💬 **流式对话** - 基于SSE的实时流式响应
- 🧠 **上下文管理** - 多轮对话上下文保持
- ⚡ **快速回复** - 智能生成回复建议
- 📝 **消息管理** - 支持复制、重新生成、点赞、导出
- 💾 **会话管理** - ChatID机制支持会话持久化
- ⚙️ **配置管理** - 灵活的API配置和参数调整

### AI配置功能

#### 两步配置流程

**步骤1：API连接配置**
1. 输入API地址和API Key
2. 点击"验证并继续"按钮
3. 系统调用 `/models` 接口验证连接
4. 验证成功后进入步骤2

**步骤2：模型选择**
1. 从API获取的模型列表中选择模型
2. 配置最大令牌数和创造性参数
3. 点击"保存配置"完成设置

#### 配置参数说明

**API地址 (baseUrl)**
- 默认值：`http://47.236.87.251:3000/api`
- 说明：AI服务的API端点地址

**API Key (apiKey)**
- 说明：API访问密钥，用于身份验证
- 格式：Bearer Token

**模型 (model)**
- 默认值：`qwen2.5:7b`
- 说明：从API动态获取，显示name，传输使用id

**最大令牌数 (maxTokens)**
- 默认值：`4000`
- 范围：100-8000
- 说明：单次对话的最大令牌数

**创造性 (temperature)**
- 默认值：`0.7`
- 范围：0-1
- 说明：控制AI回复的创造性

### 模型选择功能

#### 工作流程

```
初始化 → 调用 /api/models 接口
    ↓
获取模型列表 [{id, name}, ...]
    ↓
下拉框显示 name，值为 id
    ↓
用户选择模型
    ↓
保存模型 id 到配置
    ↓
聊天时使用模型 id
```

#### 数据格式

**API返回格式：**
```json
{
  "data": [
    {
      "id": "qwen2.5:7b",
      "name": "Qwen2.5 7B"
    }
  ]
}
```

**聊天请求格式：**
```json
{
  "model": "qwen2.5:7b",
  "messages": [
    {"role": "user", "content": "你好"}
  ]
}
```

### AI聊天功能优化

基于 OpenWebUI API 最佳实践进行了全面优化。

#### 支持的API格式

1. **OpenAI/OpenWebUI 标准格式**
2. **Ollama 格式**
3. **简化格式**

#### 流式响应处理

- 支持 `[DONE]` 结束信号
- 支持 `done: true` 结束信号
- 支持多种内容提取格式
- 完善的错误处理

#### RAG功能支持

**使用文件：**
```javascript
await aiService.sendMessageWithFiles(
  '总结这个文档',
  [{ type: 'file', id: 'doc-123' }]
)
```

**使用知识库：**
```javascript
await aiService.sendMessageWithCollection(
  '关于养殖的最佳实践',
  'farming-knowledge-base'
)
```

### 图标更新

所有AI助手相关的图标已更新为专业的神农兽医助手图标：
- 图标文件：`src/assets/images/Shennong_Vet_Assistant_Icon.png`
- 背景：透明
- 样式：圆形，无边框
- 应用位置：浮动按钮、聊天头像、消息头像等

---

## 开发指南

### 添加新页面

1. 在 `src/pages/` 创建页面组件
2. 在 `src/router.js` 注册路由
3. 在 `src/app.js` 配置路由映射
4. 添加对应的样式文件

### 添加新服务

1. 在 `src/services/` 创建服务类
2. 实现标准的服务接口
3. 在需要的组件中导入使用
4. 添加相应的单元测试

### 配置管理

```javascript
import { ConfigService } from './services/configService.js'

const configService = new ConfigService()
await configService.loadConfig()
const aiConfig = configService.getAIConfig()
```

### 事件通信

```javascript
import { EventBus } from './utils/eventBus.js'

// 监听事件
EventBus.on('user:login', (user) => {
  console.log('用户登录:', user)
})

// 触发事件
EventBus.emit('user:login', { name: '张三' })
```

---

## 部署说明

### 构建生产版本

```bash
# 构建
npm run build

# 预览构建结果
npm run preview
```

### Nginx配置示例

```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /path/to/dist;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    location /api {
        proxy_pass http://47.236.87.251:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

## 更新日志

### v2.1.0 (2025-01-16)

**AI功能完善：**
- ✅ 实现两步API配置流程
- ✅ 添加API连接验证功能
- ✅ 实现动态模型加载
- ✅ 优化聊天功能（基于OpenWebUI最佳实践）
- ✅ 添加RAG功能支持
- ✅ 更新AI助手图标
- ✅ 移除图标背景和边框

**技术改进：**
- ✅ 增强错误处理
- ✅ 添加详细日志输出
- ✅ 优化流式响应处理
- ✅ 支持多种API格式

### v2.0.0 (2025-01-15)

**项目重构：**
- ✅ 从单文件HTML重构为模块化项目
- ✅ 实现路由管理系统
- ✅ 建立服务层架构
- ✅ 添加配置管理功能
- ✅ 实现事件总线通信

---

## 常见问题

### Q1: AI服务调用失败？
**A:** 检查以下几点：
1. API地址是否正确
2. API Key是否有效
3. 网络连接是否正常
4. 查看浏览器控制台错误信息

### Q2: 模型列表加载失败？
**A:** 可能原因：
1. API地址配置错误
2. API Key无效
3. 网络连接问题
4. API服务不可用

### Q3: 配置保存后不生效？
**A:**
1. 检查localStorage是否被禁用
2. 查看浏览器控制台的错误信息
3. 尝试清除localStorage后重新配置

### Q4: 图标显示异常？
**A:**
1. 确保图标文件存在于正确路径
2. 清除浏览器缓存
3. 检查图标文件是否损坏

---

## 技术支持

### 联系方式

- **电话**：400-626-8888
- **邮箱**：it@ynsnjt.com
- **工作时间**：周一至周五 9:00-18:00

### 相关链接

- **项目地址**: https://github.com/your-org/shengnong-platform-v2
- **问题反馈**: https://github.com/your-org/shengnong-platform-v2/issues
- **官方网站**: https://www.shengnong.com

---

<div align="center">

**🌾 神农集团数字化平台 v2.0 - 让农牧业更智慧 🌾**

Made with ❤️ by 神农集团技术团队

</div>
